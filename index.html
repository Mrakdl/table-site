<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–¢–∞–±–ª–∏—Ü–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #1e1e1e;
      color: #eee;
      padding: 20px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #444;
      padding: 8px;
      text-align: left;
    }
    input, button {
      margin: 4px;
      padding: 6px;
      background-color: #2e2e2e;
      border: 1px solid #555;
      color: #eee;
    }
    button:hover {
      background-color: #444;
      cursor: pointer;
    }
    .danger {
      background-color: #700;
      border-color: #a00;
    }
    .danger:hover {
      background-color: #900;
    }
  </style>
</head>
<body>
  <h1>üì¶ –¢–∞–±–ª–∏—Ü–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤</h1>

  <button onclick="clearDatabase()" class="danger">üóë –£–¥–∞–ª–∏—Ç—å –≤—Å—ë</button>

  <h2>–ü–æ–∏—Å–∫</h2>
  <input id="search" placeholder="minecraft:planks:2">
  <button onclick="applySearch()">–ò—Å–∫–∞—Ç—å</button>

  <h2>–î–æ–±–∞–≤–∏—Ç—å / –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</h2>
  <input id="mod" placeholder="–ú–æ–¥">
  <input id="itemId" placeholder="ID" type="number">
  <input id="meta" placeholder="Meta" type="number">
  <input id="itemName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
  <input id="priceMin" placeholder="–¶–µ–Ω–∞ MIN" type="number">
  <input id="priceMax" placeholder="–¶–µ–Ω–∞ MAX" type="number">
  <button onclick="addOrUpdateItem()">–î–æ–±–∞–≤–∏—Ç—å</button>

  <table>
    <thead>
      <tr>
        <th>Mod:Item:Meta</th>
        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
        <th>–¶–µ–Ω–∞ MIN</th>
        <th>–¶–µ–Ω–∞ MAX</th>
        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>

  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDQmevn7yx4_V_s9WnGVHx_s91jboqMtVY",
      authDomain: "items-table.firebaseapp.com",
      databaseURL: "https://items-table-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "items-table",
      storageBucket: "items-table.firebasestorage.app",
      messagingSenderId: "6458579493",
      appId: "1:6458579493:web:2cae8479d416be37723dcc",
      measurementId: "G-E3B59T1VYJ"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let editKey = null;

    function addOrUpdateItem() {
      const mod = document.getElementById("mod").value.trim();
      const itemId = document.getElementById("itemId").value.trim();
      const meta = document.getElementById("meta").value.trim();
      const itemName = document.getElementById("itemName").value.trim();
      const priceMin = document.getElementById("priceMin").value.trim();
      const priceMax = document.getElementById("priceMax").value.trim();

      if (!mod || !itemId || !meta || !itemName) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è");

      const data = { mod, itemId, meta, itemName, priceMin, priceMax };

      if (editKey) {
        db.ref("items/" + editKey).set(data);
        editKey = null;
      } else {
        db.ref("items").push(data);
      }

      clearForm();
    }

    function clearForm() {
      ["mod", "itemId", "meta", "itemName", "priceMin", "priceMax"].forEach(id => {
        document.getElementById(id).value = "";
      });
    }

    function renderTable(data) {
      const tableBody = document.getElementById("tableBody");
      tableBody.innerHTML = "";

      Object.entries(data).forEach(([key, item]) => {
        const row = document.createElement("tr");

        const fullId = `${item.mod}:${item.itemId}:${item.meta}`;

        row.innerHTML = `
          <td>${fullId}</td>
          <td>${item.itemName}</td>
          <td>${item.priceMin || ""}</td>
          <td>${item.priceMax || ""}</td>
          <td>
            <button onclick="editItem('${key}')">‚úèÔ∏è</button>
            <button onclick="deleteItem('${key}')" class="danger">üóë</button>
          </td>
        `;

        tableBody.appendChild(row);
      });
    }

    function editItem(key) {
      db.ref("items/" + key).once("value").then(snapshot => {
        const item = snapshot.val();
        if (!item) return;

        document.getElementById("mod").value = item.mod;
        document.getElementById("itemId").value = item.itemId;
        document.getElementById("meta").value = item.meta;
        document.getElementById("itemName").value = item.itemName;
        document.getElementById("priceMin").value = item.priceMin;
        document.getElementById("priceMax").value = item.priceMax;

        editKey = key;
      });
    }

    function deleteItem(key) {
      if (confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç?")) {
        db.ref("items/" + key).remove();
      }
    }

    function applySearch() {
      const query = document.getElementById("search").value.trim().toLowerCase();

      db.ref("items").once("value").then(snapshot => {
        const data = snapshot.val() || {};
        const filtered = {};

        Object.entries(data).forEach(([key, item]) => {
          const fullId = `${item.mod}:${item.itemId}:${item.meta}`.toLowerCase();
          if (fullId.includes(query)) {
            filtered[key] = item;
          }
        });

        renderTable(filtered);
      });
    }

    function clearDatabase() {
      if (confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–ï –ø—Ä–µ–¥–º–µ—Ç—ã?")) {
        db.ref("items").remove()
          .then(() => alert("–í—Å–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã."))
          .catch((error) => alert("–û—à–∏–±–∫–∞: " + error));
      }
    }

    db.ref("items").on("value", (snapshot) => {
      const data = snapshot.val() || {};
      renderTable(data);
    });
  </script>
</body>
</html>
