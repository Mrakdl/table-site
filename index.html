<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–¢–∞–±–ª–∏—Ü–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤</title>
  <style>
    body {
      background: #1e1e2f;
      color: #eee;
      font-family: 'Segoe UI', sans-serif;
      padding: 40px;
    }
    h2 {
      color: #c9bfff;
      margin-top: 40px;
    }
    input[type="file"], input, button {
      background: #2c2c40;
      color: #eee;
      border: 1px solid #555;
      padding: 8px 12px;
      margin: 6px 4px;
      border-radius: 5px;
      font-size: 14px;
    }
    input:focus, button:hover {
      outline: none;
      background: #39395c;
    }
    button {
      cursor: pointer;
      transition: background 0.2s;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: #2a2a3e;
      border-radius: 6px;
      overflow: hidden;
    }
    th, td {
      border: 1px solid #444;
      padding: 10px;
      text-align: left;
      font-size: 14px;
    }
    th {
      background: #4b3b8f;
      color: #fff;
    }
    tbody tr:hover {
      background: #3d3463;
    }
    .actions button {
      margin-right: 4px;
    }
  </style>
</head>
<body>

  <h1>üì¶ –¢–∞–±–ª–∏—Ü–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤</h1>

  <h2>–ò–º–ø–æ—Ä—Ç –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∏–∑ CSV</h2>
  <input type="file" id="csvInput" accept=".csv">
  <button onclick="importCSV()">–ó–∞–≥—Ä—É–∑–∏—Ç—å CSV</button>

  <h2>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ / —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
  <div>
    <input id="mod" placeholder="–ú–æ–¥">
    <input id="itemId" placeholder="ID" type="number">
    <input id="meta" placeholder="Meta" type="number">
    <input id="itemName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
    <input id="priceMin" placeholder="–ú–∏–Ω. —Ü–µ–Ω–∞" type="number">
    <input id="priceMax" placeholder="–ú–∞–∫—Å. —Ü–µ–Ω–∞" type="number">
    <button id="saveBtn" onclick="saveItem()">–î–æ–±–∞–≤–∏—Ç—å</button>
  </div>

  <h2>–ü–æ–∏—Å–∫</h2>
  <input id="search" placeholder="minecraft:planks:2">
  <button onclick="applySearch()">–ò—Å–∫–∞—Ç—å</button>

  <h2>–¢–∞–±–ª–∏—Ü–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤</h2>
  <table>
    <thead>
      <tr>
        <th>Mod</th>
        <th>ID</th>
        <th>Meta</th>
        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
        <th>–ú–∏–Ω</th>
        <th>–ú–∞–∫—Å</th>
        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>

  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDQmevn7yx4_V_s9WnGVHx_s91jboqMtVY",
      authDomain: "items-table.firebaseapp.com",
      databaseURL: "https://items-table-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "items-table",
      storageBucket: "items-table.firebasestorage.app",
      messagingSenderId: "6458579493",
      appId: "1:6458579493:web:2cae8479d416be37723dcc",
      measurementId: "G-E3B59T1VYJ"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let editingKey = null;

    function importCSV() {
      const file = document.getElementById("csvInput").files[0];
      if (!file) return alert("–í—ã–±–µ—Ä–∏—Ç–µ CSV-—Ñ–∞–π–ª");

      const reader = new FileReader();
      reader.onload = (e) => {
        const lines = e.target.result.split("\n");
        lines.shift(); // –ü—Ä–æ–ø—É—Å–∫ –∑–∞–≥–æ–ª–æ–≤–∫–∞
        lines.forEach(line => {
          const [raw, name] = line.split(",");
          if (!raw || !name) return;
          const parts = raw.trim().split(":");
          if (parts.length !== 3) return;
          const [mod, itemId, meta] = parts;
          const item = {
            mod: mod.trim(),
            itemId: itemId.trim(),
            meta: meta.trim(),
            itemName: name.trim(),
            priceMin: "",
            priceMax: ""
          };
          db.ref("items").push(item);
        });
      };
      reader.readAsText(file);
    }

    function saveItem() {
      const item = {
        mod: document.getElementById("mod").value.trim(),
        itemId: document.getElementById("itemId").value.trim(),
        meta: document.getElementById("meta").value.trim(),
        itemName: document.getElementById("itemName").value.trim(),
        priceMin: document.getElementById("priceMin").value.trim(),
        priceMax: document.getElementById("priceMax").value.trim()
      };

      if (!item.mod || !item.itemId || !item.itemName) {
        return alert("Mod, ID –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã");
      }

      if (editingKey) {
        db.ref("items/" + editingKey).set(item);
        editingKey = null;
        document.getElementById("saveBtn").innerText = "–î–æ–±–∞–≤–∏—Ç—å";
      } else {
        db.ref("items").push(item);
      }

      clearForm();
    }

    function clearForm() {
      ["mod", "itemId", "meta", "itemName", "priceMin", "priceMax"].forEach(id => {
        document.getElementById(id).value = "";
      });
    }

    function renderTable(data) {
      const tbody = document.getElementById("tableBody");
      tbody.innerHTML = "";
      Object.entries(data).forEach(([key, item]) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${item.mod}</td>
          <td>${item.itemId}</td>
          <td>${item.meta}</td>
          <td>${item.itemName}</td>
          <td>${item.priceMin || ""}</td>
          <td>${item.priceMax || ""}</td>
          <td class="actions">
            <button onclick="editItem('${key}', ${JSON.stringify(item).replace(/"/g, '&quot;')})">‚úèÔ∏è</button>
            <button onclick="deleteItem('${key}')">üóë</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    function editItem(key, item) {
      document.getElementById("mod").value = item.mod;
      document.getElementById("itemId").value = item.itemId;
      document.getElementById("meta").value = item.meta;
      document.getElementById("itemName").value = item.itemName;
      document.getElementById("priceMin").value = item.priceMin;
      document.getElementById("priceMax").value = item.priceMax;
      editingKey = key;
      document.getElementById("saveBtn").innerText = "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å";
    }

    function deleteItem(key) {
      if (confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç?")) {
        db.ref("items/" + key).remove();
      }
    }

    function applySearch() {
      const query = document.getElementById("search").value.trim().toLowerCase();
      db.ref("items").once("value").then(snapshot => {
        const data = snapshot.val() || {};
        const filtered = {};
        Object.entries(data).forEach(([key, item]) => {
          const fullId = `${item.mod}:${item.itemId}:${item.meta}`.toLowerCase();
          if (fullId.includes(query)) {
            filtered[key] = item;
          }
        });
        renderTable(filtered);
      });
    }

    db.ref("items").on("value", (snapshot) => {
      const data = snapshot.val() || {};
      renderTable(data);
    });
  </script>
</body>
</html>
